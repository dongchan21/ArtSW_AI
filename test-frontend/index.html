<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>문제 보기</title>
</head>
<body>
  <h1>문제 선택</h1>
  <div id="problemList"></div>

  <h2>프롬프트 제출</h2>
  <form id="promptForm">
    <label for="problemId">선택된 문제 ID:</label><br>
    <input type="text" id="problemId" name="problemId" readonly><br><br>

    <label for="userPrompt">사용자 프롬프트:</label><br>
    <textarea id="userPrompt" name="userPrompt" rows="4" cols="50"></textarea><br><br>
    <button type="submit">제출</button>
  </form>

  <script>
    // 1. 문제 리스트 받아오기
    fetch("http://localhost:8000/api/problems")
      .then(response => response.json())
      .then(data => {
        const problemListDiv = document.getElementById("problemList");
        Object.entries(data).forEach(([problemId, problem]) => {
          const button = document.createElement("button");
          button.innerText = `${problemId}: ${problem.title}`;
          button.onclick = () => {
            document.getElementById("problemId").value = problemId;
          };
          problemListDiv.appendChild(button);
          problemListDiv.appendChild(document.createElement("br"));
        });
      });

    // 2. 폼 제출 핸들러
    document.getElementById("promptForm").addEventListener("submit", function(event) {
      event.preventDefault();

      const problemId = document.getElementById("problemId").value;
      const userPrompt = document.getElementById("userPrompt").value;

      if (!problemId) {
        alert("먼저 문제를 선택하세요.");
        return;
      }

      fetch("http://localhost:8000/api/submit_prompt", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ problem_id: problemId, user_prompt: userPrompt })
      })
      .then(response => response.json())
      .then(data => alert(data.message))
      .catch(error => console.error("Error:", error));
    });
  </script>

</body>
</html>
